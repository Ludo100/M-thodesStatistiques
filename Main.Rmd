---
title: "TP"
output: html_notebook
---

We imported the data of the FTSE 100 with the library qrmdata. We took the weekly returns data from the last 4 years of the available data and the 50 first stocks in alphabetical order, from 2012-01-02 to 2015-12-31. We then took d = {5,10,25} random stocks in the 50 stocks 100 times to create 100 sub-universe for each dimension. We calculated the minimum volatility and maximum diversification weights with the covariance matrix calculated from the returns of the 4 years.

The returns and volatilities of all the sub-universe were calculated as seen below.

```{r}
#Import libraries
library("here") #pas encore utilise
library("PerformanceAnalytics") #pas encore utilise
library("qrmdata")
library("quantmod")
library("RiskPortfolios")
library("vioplot")
library("zoo")

source("Functions.R")

#In-sample sensitivity analysis

#Download data of the FTSE 100 and take the first 50 stocks alphabetically
data("FTSE_const", package = "qrmdata")
stocks <- last(FTSE_const[,1:50], '4 year')
weekly_returns <- sapply(stocks,weeklyReturn)

#Merge the list weekly_returns into an xts object again to do the calculations
rets <- do.call("merge",weekly_returns)
names(rets) <- colnames(stocks)

#Fill NA with the next observation (fill backward)
rets <- na.locf(rets)
rets$DLG.L <- NULL #à vérifier

#Estimating the covariance matrix by handling missing values with casewise deletion
cov_matrix <- cov(rets, use="complete.obs")

#Compute Optimal portfolio weights for d=5,10,25 with random sub-universe
nb_universe <- 100

minvol_5 <- InSampleStats(5, nb_universe, rets, "minvol")
minvol_10 <- InSampleStats(10, nb_universe, rets, "minvol")
minvol_25 <- InSampleStats(25, nb_universe, rets, "minvol")
maxdiv_5 <- InSampleStats(5, nb_universe, rets, "maxdiv")
maxdiv_10 <- InSampleStats(10, nb_universe, rets, "maxdiv")
maxdiv_25 <- InSampleStats(25, nb_universe, rets, "maxdiv")

#À FAIRE BOXPLOT, 6 alignés avec même scale
df_volatilities <- data.frame(minvol_5$volatility, minvol_10$volatility, minvol_25$volatility,
                              maxdiv_5$volatility, maxdiv_10$volatility, maxdiv_25$volatility)

vioplot(df_volatilities, main="Distribution of volatilities", names=c("5","10","25","5","10","25"),
        col="light blue")

```
As we can see from the boxplots,

```{r}
#In-sample uncertainty



```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
